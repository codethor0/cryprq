name: Harden Runner

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  harden:
    name: Harden Runner Test
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@v2
        with:
          egress-policy: block
          allowed-endpoints: >
            crates.io:443
            static.crates.io:443
            index.crates.io:443
            github.com:443
            api.github.com:443
            objects.githubusercontent.com:443
            rosenpass.org:443
            raw.githubusercontent.com:443
      
      - uses: actions/checkout@v4
      
      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
      
      - name: Build
        run: cargo build --release
      
      - name: Test
        run: cargo test --release
